#!/bin/bash

TARGET="$1"
SCANFILE="/tmp/lockpick_scan_$TARGET.txt"
LOGFILE="/tmp/lockpick_exploits_$TARGET.txt"

if [[ -z "$TARGET" ]]; then
    echo "Usage: $0 <target IP or domain>"
    exit 1
fi

if [[ ! -f "$SCANFILE" ]]; then
    echo "Error: No scan file found for $TARGET. Run scan.sh first."
    exit 1
fi

echo "Lockpick Exploit Suggestions - $TARGET" | tee "$LOGFILE"
echo "---" >> "$LOGFILE"
echo "[+] Date: $(date)" >> "$LOGFILE"

# Extract service banners and grep out common useful lines
grep -E "^[0-9]+/tcp.*open" "$SCANFILE" | while read -r line; do
    echo "[+] Searching exploits for: $line" | tee -a "$LOGFILE"
    
    # Extract service string for searchsploit
    SERVICE=$(echo "$line" | cut -d ' ' -f 3- | sed 's/ [0-9]*\/tcp.*//g')
    
    if [[ -n "$SERVICE" ]]; then
        echo "Service: $SERVICE" >> "$LOGFILE"
        searchsploit "$SERVICE" >> "$LOGFILE"
        echo "---" >> "$LOGFILE"
    fi
done
